# FluxQ v0.1.0 项目基础 - 实现计划

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**目标**: 创建 SwiftUI 多平台应用外壳,配置 SwiftData,实现基础导航和主题系统。

**架构**: 模块化架构,使用本地 Swift Packages 分离关注点。主应用层使用 SwiftUI 多平台模板,数据层使用 SwiftData,UI 组件模块化。

**技术栈**: SwiftUI, SwiftData, Swift Package Manager, macOS 14+, iOS 17+

---

## 任务概览

1. 创建 Xcode 多平台项目
2. 配置 SwiftData 数据模型
3. 创建项目模块结构
4. 实现主界面 TabView 导航
5. 实现基础主题系统
6. 完善数据模型定义
7. 集成测试和验证

---

## Task 1: 创建 Xcode 多平台项目

**Files:**
- Create: `FluxQ.xcodeproj/`
- Create: `App/FluxQ/FluxQApp.swift`
- Create: `App/FluxQ/ContentView.swift`
- Create: `App/FluxQWatch/FluxQWatchApp.swift`

**Step 1: 创建 Xcode 项目**

```bash
# 在 Xcode 中:
# 1. File > New > Project
# 2. 选择 "Multiplatform" > "App"
# 3. Product Name: FluxQ
# 4. Interface: SwiftUI
# 5. Language: Swift
# 6. 取消勾选 "Include Tests" (稍后手动添加)
# 7. 保存到: /Users/martinadamsdev/workspace/FluxQ
```

预期结果: 创建基础项目结构,包含 FluxQ.xcodeproj

**Step 2: 配置 App Target 系统版本**

在 Xcode Project Settings 中:
- FluxQ (iOS): Minimum Deployments = iOS 17.0
- FluxQ (macOS): Minimum Deployments = macOS 14.0

**Step 3: 添加 watchOS Target**

```bash
# 在 Xcode 中:
# 1. File > New > Target
# 2. 选择 "watchOS" > "App"
# 3. Product Name: FluxQWatch
# 4. Minimum Deployments: watchOS 10.0
# 5. Embed in Application: FluxQ (iOS)
```

**Step 4: 验证项目结构**

运行以下命令验证:
```bash
ls -la App/
# 应该看到:
# FluxQ/
# FluxQWatch/
```

**Step 5: 初始编译测试**

```bash
# macOS
xcodebuild -project FluxQ.xcodeproj \
           -scheme FluxQ \
           -destination 'platform=macOS' \
           build

# iOS
xcodebuild -project FluxQ.xcodeproj \
           -scheme FluxQ \
           -destination 'platform=iOS Simulator,name=iPhone 15 Pro' \
           build
```

预期: 编译成功

**Step 6: 提交初始项目**

```bash
git add App/ FluxQ.xcodeproj/
git commit -m "chore: create Xcode multiplatform project

- Create FluxQ app target (macOS/iOS/iPadOS)
- Create FluxQWatch target (watchOS)
- Set minimum deployment targets (macOS 14+, iOS 17+, watchOS 10+)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 2: 创建 FluxQModels 模块

**Files:**
- Create: `Modules/FluxQModels/Package.swift`
- Create: `Modules/FluxQModels/Sources/FluxQModels/User.swift`
- Create: `Modules/FluxQModels/Sources/FluxQModels/Message.swift`
- Create: `Modules/FluxQModels/Sources/FluxQModels/Conversation.swift`
- Create: `Modules/FluxQModels/Sources/FluxQModels/Enums.swift`
- Create: `Modules/FluxQModels/Tests/FluxQModelsTests/UserTests.swift`

**Step 1: 创建 Package 目录结构**

```bash
mkdir -p Modules/FluxQModels/Sources/FluxQModels
mkdir -p Modules/FluxQModels/Tests/FluxQModelsTests
```

**Step 2: 创建 Package.swift**

创建 `Modules/FluxQModels/Package.swift`:

```swift
// swift-tools-version: 5.9
import PackageDescription

let package = Package(
    name: "FluxQModels",
    platforms: [
        .macOS(.v14),
        .iOS(.v17),
        .watchOS(.v10)
    ],
    products: [
        .library(
            name: "FluxQModels",
            targets: ["FluxQModels"]),
    ],
    targets: [
        .target(
            name: "FluxQModels"),
        .testTarget(
            name: "FluxQModelsTests",
            dependencies: ["FluxQModels"]),
    ]
)
```

**Step 3: 创建枚举类型**

创建 `Modules/FluxQModels/Sources/FluxQModels/Enums.swift`:

```swift
import Foundation

public enum UserStatus: String, Codable, CaseIterable {
    case online
    case away
    case busy
    case offline

    public var displayName: String {
        switch self {
        case .online: return "在线"
        case .away: return "离开"
        case .busy: return "忙碌"
        case .offline: return "离线"
        }
    }
}

public enum MessageStatus: String, Codable {
    case sending
    case sent
    case delivered
    case read
    case failed
}

public enum ConversationType: String, Codable {
    case `private`
    case group
}
```

**Step 4: 创建 User 模型**

创建 `Modules/FluxQModels/Sources/FluxQModels/User.swift`:

```swift
import Foundation
import SwiftData

@Model
public final class User {
    @Attribute(.unique) public var id: String
    public var nickname: String
    public var hostname: String
    public var ipAddress: String
    public var port: Int
    public var group: String?
    public var status: UserStatus
    public var isOnline: Bool
    public var lastSeen: Date
    public var avatar: Data?

    @Relationship(deleteRule: .cascade, inverse: \Conversation.participants)
    public var conversations: [Conversation]?

    public init(
        id: String,
        nickname: String,
        hostname: String,
        ipAddress: String,
        port: Int = 2425,
        group: String? = nil,
        status: UserStatus = .online,
        isOnline: Bool = true,
        lastSeen: Date = Date(),
        avatar: Data? = nil
    ) {
        self.id = id
        self.nickname = nickname
        self.hostname = hostname
        self.ipAddress = ipAddress
        self.port = port
        self.group = group
        self.status = status
        self.isOnline = isOnline
        self.lastSeen = lastSeen
        self.avatar = avatar
    }
}
```

**Step 5: 创建 Message 模型**

创建 `Modules/FluxQModels/Sources/FluxQModels/Message.swift`:

```swift
import Foundation
import SwiftData

@Model
public final class Message {
    @Attribute(.unique) public var id: String
    public var conversationID: String
    public var senderID: String
    public var content: String
    public var timestamp: Date
    public var status: MessageStatus
    public var isEncrypted: Bool

    public init(
        id: String = UUID().uuidString,
        conversationID: String,
        senderID: String,
        content: String,
        timestamp: Date = Date(),
        status: MessageStatus = .sending,
        isEncrypted: Bool = false
    ) {
        self.id = id
        self.conversationID = conversationID
        self.senderID = senderID
        self.content = content
        self.timestamp = timestamp
        self.status = status
        self.isEncrypted = isEncrypted
    }
}
```

**Step 6: 创建 Conversation 模型**

创建 `Modules/FluxQModels/Sources/FluxQModels/Conversation.swift`:

```swift
import Foundation
import SwiftData

@Model
public final class Conversation {
    @Attribute(.unique) public var id: String
    public var type: ConversationType
    public var participantIDs: [String]
    public var lastMessageTimestamp: Date
    public var unreadCount: Int

    @Relationship(deleteRule: .nullify)
    public var participants: [User]?

    @Relationship(deleteRule: .cascade)
    public var messages: [Message]?

    public init(
        id: String = UUID().uuidString,
        type: ConversationType,
        participantIDs: [String],
        lastMessageTimestamp: Date = Date(),
        unreadCount: Int = 0
    ) {
        self.id = id
        self.type = type
        self.participantIDs = participantIDs
        self.lastMessageTimestamp = lastMessageTimestamp
        self.unreadCount = unreadCount
    }
}
```

**Step 7: 编写 User 模型测试**

创建 `Modules/FluxQModels/Tests/FluxQModelsTests/UserTests.swift`:

```swift
import XCTest
@testable import FluxQModels

final class UserTests: XCTestCase {
    func testUserInitialization() {
        let user = User(
            id: "192.168.1.100:2425",
            nickname: "Alice",
            hostname: "MacBook-Pro",
            ipAddress: "192.168.1.100"
        )

        XCTAssertEqual(user.id, "192.168.1.100:2425")
        XCTAssertEqual(user.nickname, "Alice")
        XCTAssertEqual(user.ipAddress, "192.168.1.100")
        XCTAssertEqual(user.port, 2425)
        XCTAssertTrue(user.isOnline)
        XCTAssertEqual(user.status, .online)
    }

    func testUserStatusDisplayName() {
        XCTAssertEqual(UserStatus.online.displayName, "在线")
        XCTAssertEqual(UserStatus.away.displayName, "离开")
        XCTAssertEqual(UserStatus.busy.displayName, "忙碌")
        XCTAssertEqual(UserStatus.offline.displayName, "离线")
    }
}
```

**Step 8: 运行测试**

```bash
cd Modules/FluxQModels
swift test
```

预期: 所有测试通过

**Step 9: 添加 Package 到 Xcode 项目**

在 Xcode 中:
1. File > Add Packages...
2. Add Local... > 选择 `Modules/FluxQModels`
3. 在 FluxQ target 的 "Frameworks, Libraries, and Embedded Content" 中添加 FluxQModels

**Step 10: 提交模型模块**

```bash
git add Modules/FluxQModels/
git commit -m "feat(models): add SwiftData models for User, Message, Conversation

- Create FluxQModels Swift Package
- Define User model with SwiftData
- Define Message model
- Define Conversation model
- Add enum types (UserStatus, MessageStatus, ConversationType)
- Add unit tests for User model

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 3: 配置 SwiftData ModelContainer

**Files:**
- Modify: `App/FluxQ/FluxQApp.swift`

**Step 1: 更新 FluxQApp.swift**

修改 `App/FluxQ/FluxQApp.swift`:

```swift
import SwiftUI
import SwiftData
import FluxQModels

@main
struct FluxQApp: App {
    var sharedModelContainer: ModelContainer = {
        let schema = Schema([
            User.self,
            Message.self,
            Conversation.self,
        ])
        let modelConfiguration = ModelConfiguration(
            schema: schema,
            isStoredInMemoryOnly: false
        )

        do {
            return try ModelContainer(
                for: schema,
                configurations: [modelConfiguration]
            )
        } catch {
            fatalError("Could not create ModelContainer: \(error)")
        }
    }()

    var body: some Scene {
        WindowGroup {
            ContentView()
        }
        .modelContainer(sharedModelContainer)
    }
}
```

**Step 2: 编译测试**

```bash
xcodebuild -project FluxQ.xcodeproj \
           -scheme FluxQ \
           -destination 'platform=macOS' \
           build
```

预期: 编译成功

**Step 3: 提交 SwiftData 配置**

```bash
git add App/FluxQ/FluxQApp.swift
git commit -m "feat(app): configure SwiftData ModelContainer

- Add sharedModelContainer with User, Message, Conversation schema
- Configure persistent storage (not in-memory)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 4: 创建主界面 TabView 导航

**Files:**
- Create: `App/FluxQ/Views/MainTabView.swift`
- Create: `App/FluxQ/Views/ConversationListView.swift`
- Create: `App/FluxQ/Views/ContactsView.swift`
- Create: `App/FluxQ/Views/DiscoveryView.swift`
- Create: `App/FluxQ/Views/SettingsView.swift`
- Modify: `App/FluxQ/ContentView.swift`

**Step 1: 创建 Views 目录**

```bash
mkdir -p App/FluxQ/Views
```

**Step 2: 创建占位符视图**

创建 `App/FluxQ/Views/ConversationListView.swift`:

```swift
import SwiftUI

struct ConversationListView: View {
    var body: some View {
        NavigationStack {
            VStack {
                Image(systemName: "message.fill")
                    .font(.system(size: 60))
                    .foregroundStyle(.secondary)

                Text("暂无消息")
                    .font(.title2)
                    .foregroundStyle(.secondary)

                Text("开始一个新的对话")
                    .font(.subheadline)
                    .foregroundStyle(.tertiary)
            }
            .navigationTitle("消息")
            .toolbar {
                ToolbarItem(placement: .primaryAction) {
                    Button {
                        // TODO: 新建群聊
                    } label: {
                        Image(systemName: "plus")
                    }
                }
            }
        }
    }
}

#Preview {
    ConversationListView()
}
```

创建 `App/FluxQ/Views/ContactsView.swift`:

```swift
import SwiftUI

struct ContactsView: View {
    var body: some View {
        NavigationStack {
            List {
                Text("暂无联系人")
                    .foregroundStyle(.secondary)
            }
            .navigationTitle("通讯录")
        }
    }
}

#Preview {
    ContactsView()
}
```

创建 `App/FluxQ/Views/DiscoveryView.swift`:

```swift
import SwiftUI

struct DiscoveryView: View {
    var body: some View {
        NavigationStack {
            VStack {
                Image(systemName: "globe")
                    .font(.system(size: 60))
                    .foregroundStyle(.secondary)

                Text("暂无在线用户")
                    .font(.title2)
                    .foregroundStyle(.secondary)

                Text("下拉刷新发现局域网用户")
                    .font(.subheadline)
                    .foregroundStyle(.tertiary)
            }
            .navigationTitle("发现")
        }
    }
}

#Preview {
    DiscoveryView()
}
```

创建 `App/FluxQ/Views/SettingsView.swift`:

```swift
import SwiftUI

struct SettingsView: View {
    var body: some View {
        NavigationStack {
            Form {
                Section("个人信息") {
                    HStack {
                        Text("昵称")
                        Spacer()
                        Text("未设置")
                            .foregroundStyle(.secondary)
                    }

                    HStack {
                        Text("部门")
                        Spacer()
                        Text("未设置")
                            .foregroundStyle(.secondary)
                    }
                }

                Section("状态") {
                    Picker("当前状态", selection: .constant("在线")) {
                        Text("在线").tag("在线")
                        Text("离开").tag("离开")
                        Text("忙碌").tag("忙碌")
                    }
                }
            }
            .navigationTitle("我")
        }
    }
}

#Preview {
    SettingsView()
}
```

**Step 3: 创建 MainTabView**

创建 `App/FluxQ/Views/MainTabView.swift`:

```swift
import SwiftUI

struct MainTabView: View {
    var body: some View {
        TabView {
            ConversationListView()
                .tabItem {
                    Label("消息", systemImage: "message.fill")
                }

            ContactsView()
                .tabItem {
                    Label("通讯录", systemImage: "person.2.fill")
                }

            DiscoveryView()
                .tabItem {
                    Label("发现", systemImage: "globe")
                }

            SettingsView()
                .tabItem {
                    Label("我", systemImage: "person.fill")
                }
        }
    }
}

#Preview {
    MainTabView()
}
```

**Step 4: 更新 ContentView 使用 MainTabView**

修改 `App/FluxQ/ContentView.swift`:

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        MainTabView()
    }
}

#Preview {
    ContentView()
}
```

**Step 5: 运行应用测试导航**

在 Xcode 中:
1. 选择 FluxQ scheme
2. 选择 macOS 或 iOS 模拟器
3. Product > Run (⌘R)

验证:
- TabView 显示 4 个标签
- 可以在标签间切换
- 每个标签显示占位符内容

**Step 6: 提交导航实现**

```bash
git add App/FluxQ/Views/ App/FluxQ/ContentView.swift
git commit -m "feat(ui): implement TabView navigation with 4 tabs

- Create MainTabView with Messages/Contacts/Discovery/Settings tabs
- Add placeholder views for each tab
- WeChat-style tab bar layout with SF Symbols icons
- Update ContentView to use MainTabView

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 5: 创建 FluxQUI 主题模块

**Files:**
- Create: `Modules/FluxQUI/Package.swift`
- Create: `Modules/FluxQUI/Sources/FluxQUI/Theme/Colors.swift`
- Create: `Modules/FluxQUI/Sources/FluxQUI/Theme/ThemeManager.swift`

**Step 1: 创建 Package 结构**

```bash
mkdir -p Modules/FluxQUI/Sources/FluxQUI/Theme
```

**Step 2: 创建 Package.swift**

创建 `Modules/FluxQUI/Package.swift`:

```swift
// swift-tools-version: 5.9
import PackageDescription

let package = Package(
    name: "FluxQUI",
    platforms: [
        .macOS(.v14),
        .iOS(.v17),
        .watchOS(.v10)
    ],
    products: [
        .library(
            name: "FluxQUI",
            targets: ["FluxQUI"]),
    ],
    targets: [
        .target(
            name: "FluxQUI"),
    ]
)
```

**Step 3: 定义主题颜色**

创建 `Modules/FluxQUI/Sources/FluxQUI/Theme/Colors.swift`:

```swift
import SwiftUI

extension Color {
    // 主题色(类似 WeChat 绿)
    public static let fluxqGreen = Color(red: 0.0, green: 0.78, blue: 0.33)

    // 聊天气泡颜色
    public static let fluxqBubbleMe = Color.fluxqGreen
    public static let fluxqBubbleOther = Color(.systemGray5)

    // 状态颜色
    public static let fluxqOnline = Color.green
    public static let fluxqAway = Color.orange
    public static let fluxqBusy = Color.red
    public static let fluxqOffline = Color.gray
}

extension ShapeStyle where Self == Color {
    public static var fluxqGreen: Color { .fluxqGreen }
    public static var fluxqBubbleMe: Color { .fluxqBubbleMe }
    public static var fluxqBubbleOther: Color { .fluxqBubbleOther }
}
```

**Step 4: 创建 ThemeManager**

创建 `Modules/FluxQUI/Sources/FluxQUI/Theme/ThemeManager.swift`:

```swift
import SwiftUI

@Observable
public final class ThemeManager {
    public static let shared = ThemeManager()

    public var colorScheme: ColorScheme?

    private init() {}

    public func setColorScheme(_ scheme: ColorScheme?) {
        self.colorScheme = scheme
    }
}

// View Extension for easy theme access
extension View {
    public func themedColorScheme(_ manager: ThemeManager = .shared) -> some View {
        self.preferredColorScheme(manager.colorScheme)
    }
}
```

**Step 5: 添加到 Xcode 项目**

在 Xcode 中:
1. File > Add Packages...
2. Add Local... > 选择 `Modules/FluxQUI`
3. 在 FluxQ target 添加 FluxQUI 依赖

**Step 6: 在 SettingsView 中应用主题**

修改 `App/FluxQ/Views/SettingsView.swift`:

```swift
import SwiftUI
import FluxQUI

struct SettingsView: View {
    @State private var selectedTheme: String = "系统"

    var body: some View {
        NavigationStack {
            Form {
                Section("个人信息") {
                    HStack {
                        Text("昵称")
                        Spacer()
                        Text("未设置")
                            .foregroundStyle(.secondary)
                    }

                    HStack {
                        Text("部门")
                        Spacer()
                        Text("未设置")
                            .foregroundStyle(.secondary)
                    }
                }

                Section("状态") {
                    Picker("当前状态", selection: .constant("在线")) {
                        Text("在线").tag("在线")
                        Text("离开").tag("离开")
                        Text("忙碌").tag("忙碌")
                    }
                }

                Section("外观") {
                    Picker("主题", selection: $selectedTheme) {
                        Text("浅色").tag("浅色")
                        Text("深色").tag("深色")
                        Text("系统").tag("系统")
                    }
                    .onChange(of: selectedTheme) { _, newValue in
                        switch newValue {
                        case "浅色":
                            ThemeManager.shared.setColorScheme(.light)
                        case "深色":
                            ThemeManager.shared.setColorScheme(.dark)
                        default:
                            ThemeManager.shared.setColorScheme(nil)
                        }
                    }
                }
            }
            .navigationTitle("我")
        }
    }
}
```

**Step 7: 在 FluxQApp 应用主题**

修改 `App/FluxQ/FluxQApp.swift`,添加主题支持:

```swift
import SwiftUI
import SwiftData
import FluxQModels
import FluxQUI

@main
struct FluxQApp: App {
    @State private var themeManager = ThemeManager.shared

    var sharedModelContainer: ModelContainer = {
        let schema = Schema([
            User.self,
            Message.self,
            Conversation.self,
        ])
        let modelConfiguration = ModelConfiguration(
            schema: schema,
            isStoredInMemoryOnly: false
        )

        do {
            return try ModelContainer(
                for: schema,
                configurations: [modelConfiguration]
            )
        } catch {
            fatalError("Could not create ModelContainer: \(error)")
        }
    }()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .themedColorScheme(themeManager)
        }
        .modelContainer(sharedModelContainer)
    }
}
```

**Step 8: 测试主题切换**

运行应用:
1. 进入"我"标签
2. 切换主题选项(浅色/深色/系统)
3. 验证界面颜色变化

**Step 9: 提交主题系统**

```bash
git add Modules/FluxQUI/ App/FluxQ/Views/SettingsView.swift App/FluxQ/FluxQApp.swift
git commit -m "feat(ui): add theme system with light/dark/system modes

- Create FluxQUI module with Theme support
- Define FluxQ brand colors (green, bubble colors, status colors)
- Implement ThemeManager for color scheme management
- Add theme picker in Settings view
- Support light/dark/system appearance

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 6: 添加 watchOS 基础界面

**Files:**
- Modify: `App/FluxQWatch/FluxQWatchApp.swift`
- Create: `App/FluxQWatch/Views/MessageListView.swift`

**Step 1: 更新 FluxQWatchApp**

修改 `App/FluxQWatch/FluxQWatchApp.swift`:

```swift
import SwiftUI

@main
struct FluxQWatchApp: App {
    var body: some Scene {
        WindowGroup {
            MessageListView()
        }
    }
}
```

**Step 2: 创建 watchOS 消息列表**

创建 `App/FluxQWatch/Views/MessageListView.swift`:

```swift
import SwiftUI

struct MessageListView: View {
    var body: some View {
        NavigationStack {
            List {
                VStack {
                    Image(systemName: "message.fill")
                        .font(.largeTitle)
                        .foregroundStyle(.secondary)

                    Text("暂无消息")
                        .font(.caption)
                        .foregroundStyle(.secondary)
                }
                .frame(maxWidth: .infinity)
                .listRowBackground(Color.clear)
            }
            .navigationTitle("FluxQ")
        }
    }
}

#Preview {
    MessageListView()
}
```

**Step 3: 测试 watchOS 应用**

在 Xcode 中:
1. 选择 FluxQWatch scheme
2. 选择 Apple Watch 模拟器
3. Product > Run (⌘R)

验证: 应用在 watchOS 上显示简单的消息列表占位符

**Step 4: 提交 watchOS 界面**

```bash
git add App/FluxQWatch/
git commit -m "feat(watch): add basic watchOS interface

- Create MessageListView for watchOS
- Simple empty state placeholder
- Foundation for future notification features

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

---

## Task 7: 添加测试和最终验证

**Files:**
- Create: `Tests/FluxQTests/FluxQTests.swift`
- Create: `Tests/FluxQUITests/FluxQUITests.swift`

**Step 1: 添加测试 target**

在 Xcode 中:
1. File > New > Target
2. 选择 "macOS" > "Unit Testing Bundle"
3. Product Name: FluxQTests
4. 添加 FluxQModels 依赖

**Step 2: 创建基础测试**

创建 `Tests/FluxQTests/FluxQTests.swift`:

```swift
import XCTest
import SwiftData
@testable import FluxQModels

final class FluxQTests: XCTestCase {
    var modelContainer: ModelContainer!
    var modelContext: ModelContext!

    override func setUp() {
        super.setUp()

        let schema = Schema([
            User.self,
            Message.self,
            Conversation.self,
        ])
        let modelConfiguration = ModelConfiguration(
            schema: schema,
            isStoredInMemoryOnly: true
        )

        do {
            modelContainer = try ModelContainer(
                for: schema,
                configurations: [modelConfiguration]
            )
            modelContext = ModelContext(modelContainer)
        } catch {
            fatalError("Failed to create ModelContainer: \(error)")
        }
    }

    override func tearDown() {
        modelContainer = nil
        modelContext = nil
        super.tearDown()
    }

    func testUserCreationAndPersistence() throws {
        // Create a user
        let user = User(
            id: "test-user",
            nickname: "Test User",
            hostname: "TestHost",
            ipAddress: "192.168.1.100"
        )

        modelContext.insert(user)
        try modelContext.save()

        // Fetch the user
        let descriptor = FetchDescriptor<User>()
        let users = try modelContext.fetch(descriptor)

        XCTAssertEqual(users.count, 1)
        XCTAssertEqual(users.first?.nickname, "Test User")
    }

    func testMessageCreation() throws {
        let message = Message(
            conversationID: "conv-1",
            senderID: "user-1",
            content: "Hello, World!"
        )

        modelContext.insert(message)
        try modelContext.save()

        XCTAssertEqual(message.content, "Hello, World!")
        XCTAssertEqual(message.status, .sending)
    }

    func testConversationCreation() throws {
        let conversation = Conversation(
            type: .private,
            participantIDs: ["user-1", "user-2"]
        )

        modelContext.insert(conversation)
        try modelContext.save()

        XCTAssertEqual(conversation.type, .private)
        XCTAssertEqual(conversation.participantIDs.count, 2)
        XCTAssertEqual(conversation.unreadCount, 0)
    }
}
```

**Step 3: 运行所有测试**

```bash
# 运行 FluxQModels 测试
cd Modules/FluxQModels
swift test

# 运行应用测试
cd ../..
xcodebuild -project FluxQ.xcodeproj \
           -scheme FluxQ \
           -destination 'platform=macOS' \
           test
```

预期: 所有测试通过

**Step 4: 验证所有平台编译**

```bash
# macOS
xcodebuild -project FluxQ.xcodeproj -scheme FluxQ -destination 'platform=macOS' build

# iOS
xcodebuild -project FluxQ.xcodeproj -scheme FluxQ -destination 'platform=iOS Simulator,name=iPhone 15 Pro' build

# watchOS
xcodebuild -project FluxQ.xcodeproj -scheme FluxQWatch -destination 'platform=watchOS Simulator,name=Apple Watch Series 9 (45mm)' build
```

预期: 所有平台编译成功

**Step 5: 更新 README**

在 README.md 中添加 v0.1.0 完成状态:

```markdown
## 版本状态

- [x] v0.1.0 - 项目基础 ✅
```

**Step 6: 提交测试**

```bash
git add Tests/ README.md
git commit -m "test: add unit tests for SwiftData models

- Add FluxQTests with model persistence tests
- Test User, Message, Conversation creation
- Verify all platforms build successfully
- Update README with v0.1.0 completion status

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

**Step 7: 创建 v0.1.0 tag**

```bash
git tag v0.1.0
git push origin main --tags
```

---

## 验证清单

完成 v0.1.0 后,验证以下内容:

- [ ] 应用在 macOS/iOS/iPadOS 上启动成功
- [ ] TabView 可以切换 4 个标签
- [ ] 每个标签显示占位符内容
- [ ] SwiftData ModelContainer 配置正确
- [ ] 可以创建 User/Message/Conversation 并保存
- [ ] 主题切换(浅色/深色/系统)正常工作
- [ ] watchOS 应用显示基础界面
- [ ] 所有测试通过
- [ ] 所有平台编译成功

## 下一步

v0.1.0 完成后,继续 v0.2.0 - 局域网发现:

1. 实现 IPMsgProtocol 模块
2. UDP 广播用户发现
3. 在线用户列表 UI

详见 `docs/plans/v0.2.0.md`
